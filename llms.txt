# covr2gh

{covr2gh} was born from a need to have test coverage information to hand
when reviewing a pull request.

Due to constraints in enterprise environments, this often needs to be
accomplished without depending on a 3rd party vendor, or an
[un-verified](https://docs.github.com/en/actions/how-tos/create-and-publish-actions/publish-in-github-marketplace#about-badges-in-github-marketplace)
/ unvetted GitHub Action.

The core functionality focuses on extracting coverage data (with
[`covr::package_coverage()`](http://covr.r-lib.org/reference/package_coverage.md))
and on presenting a brief summary as a comment on a GitHub pull request
(PR).

## Installation

You can install the development version of covr2gh from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("dragosmg/covr2gh")
```

## Example

The package is designed to be used with GitHub Actions. It has an
accompanying workflow that does the following:

- runs
  [`covr::package_coverage()`](http://covr.r-lib.org/reference/package_coverage.md)
  on both the head and base branches.
- compares the outputs and prepares a comment, made up of:
  - two high-level summary sentences (one focused on the overall text
    coverage, the other focused on the diff coverage)
  - a collapsible “Details” section containing two tables which offer
    more insight into the high-level summaries.
- produces a coverage badge for the head branch and pushes it to a
  “storage” branch (`_covr2gh_storage`)[¹](#fn1).

------------------------------------------------------------------------

1.  This is not possible for PRs originating from forks as they will not
    have write permissions to the repo. In this case the produced badge
    is not self-contained and an external - to the repo - ULR is used
    instead of committing the badge to the storage branch.

# Package index

## All functions

- [`compose_comment()`](https://dragosmg.github.io/covr2gh/reference/compose_comment.md)
  : Compose a coverage comment
- [`generate_badge()`](https://dragosmg.github.io/covr2gh/reference/generate_badge.md)
  : Generate a coverage badge
- [`post_comment()`](https://dragosmg.github.io/covr2gh/reference/post_comment.md)
  : Post or update comment
- [`use_covr2gh_action()`](https://dragosmg.github.io/covr2gh/reference/use_covr2gh_action.md)
  : Set up a covr2gh GitHub Action workflow
- [`use_covr2gh_badge()`](https://dragosmg.github.io/covr2gh/reference/use_covr2gh_badge.md)
  : Add a coverage README badge

